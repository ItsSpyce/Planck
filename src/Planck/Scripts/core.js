var planck=function(){"use strict";function E(e,t,o){return new Promise((s,r)=>{function n(i){if(i.data.operationId===t&&(typeof o>"u"||o(i.data.body))){const u=new Date().getTime()-a.getTime();console.debug("Received webmessage",t,i.data,u),window.chrome.webview.removeEventListener("message",n),i.data.error?r(i.data.error):s(i.data.body)}}window.chrome.webview.addEventListener("message",n);const a=new Date;window.chrome.webview.postMessage({...e,operationId:t}),console.debug("Posted webmessage",t,e)})}function T(e,t,o){let s=null;function r(a){if(a.data.operationId===t&&(typeof o>"u"||o(a.data.body))){const i=new Date().getTime()-n.getTime();if(console.debug("Received webmessage",t,a.data,i),window.chrome.webview.removeEventListener("message",r),a.data.error)throw a.data.error;s=a.data.body}}window.chrome.webview.addEventListener("message",r);const n=new Date;return window.chrome.webview.postMessage({...e,operationId:t}),console.debug("Posted sync webmessage",t,e),s}function O(){let e=-1;return{current:e,next(){return e===Number.MAX_SAFE_INTEGER?e=0:e++,e}}}function p(e,t){return new Promise((o,s)=>{const r=setInterval(()=>{e()&&(clearTimeout(n),clearInterval(r),o(!0))},5),n=setTimeout(()=>{s("Wait timed out")},t||1e3)})}const m=O();async function d(e,t){const o=m.next();return await E({command:e,body:t},o)}function b(e,t){const o=m.next();return T({command:e,body:t},o)}const S=1024;class D{get remainingBytes(){return this._ledger.length-this._ledger.position}constructor(t){this._isClosed=!1,this._ledger=t,this._buffer=new Uint8Array(Math.min(t.length,S))}canRead(){return this.remainingBytes>0}[Symbol.asyncIterator](){}async readToEnd(){if(this._isClosed)throw"Cannot read from a closed stream";if(!this.canRead())return this._buffer;const t=await d("READ_STREAM",{id:this._ledger.id});return this._buffer=h(t),this._ledger.position+=this._buffer.length,this._buffer}async readNext(){if(this._isClosed)throw"Cannot read from a closed stream";if(!this.canRead())return null;const t=await d("READ_STREAM_CHUNK",{id:this._ledger.id});return this._buffer=h(t),this._ledger.position+=this._buffer.length,this._buffer}data(){return this._buffer}text(){return new TextDecoder().decode(this._buffer)}async close(){await d("CLOSE_STREAM",{id:this._ledger.id}),this._isClosed=!0}}function h(e){return Uint8Array.from(atob(e),t=>t.charCodeAt(0))}const c=Object.create(null),f=[];window.chrome.webview.addEventListener("message",e=>{if(e.data?.command==="MODULE_PROP_CHANGED"){const{Name:t,Value:o,Module:s}=e.data.body;console.debug("Received module prop updated",t,s);const r=c[s];typeof r<"u"&&r.updateValue(t,o)}});async function M(e){if(f.includes(e))try{return console.debug("Loading in process, waiting",e),await p(()=>!f.includes(e)),console.debug("Completed wait for",e),c[e]}catch(s){console.debug(s)}if(e in c)return c[e];f.push(e);const t=await d("LOAD_MODULE",{id:e}),o=await W(e,t);return f.splice(f.indexOf(e),1),c[e]=o,o}var l;(function(e){e.string="string",e.boolean="boolean",e.number="number",e.object="object",e.stream="stream",e.array="array",e.void="void"})(l||(l={}));const w={[l.stream]:e=>new D(e)};async function W(e,t){const o=Object.create({updateValue(r,n){return o[r]=n}}),s=t.reduce((r,n)=>({...r,[n.name]:n}),Object.create(null));return new Proxy(o,{get(r,n,a){if(typeof r[n]<"u")return r[n];if(typeof n=="symbol")return Reflect.get(r,n,a);const i=s[n];if(!(typeof i>"u")){if(i.isMethod)return async function(...u){const v=await d("INVOKE_MODULE_METHOD",{id:e,method:n,args:u});return typeof w[i.returnType]<"u"?w[i.returnType](v):v};if(typeof r[n]<"u")return r[n];if(i.hasGetter){let u=b("GET_MODULE_PROP",{prop:n,id:e,args:{}});return typeof w[i.returnType]<"u"&&(u=w[i.returnType](u)),r[n]=u}throw"Export does not have a public getter"}},set(r,n,a,i){if(typeof n=="string"&&typeof s[n]<"u"&&!b("SET_MODULE_PROP",{value:a}))throw`Failed to update property ${n}, check logs`;return r[n]=a},deleteProperty(r,n){return typeof n=="string"&&typeof s[n]<"u"&&s[n].returnType===l.stream?(r[n].close(),delete r[n]):!1},has(r,n){return Object.hasOwn(r,n)}})}function _(e){return document.title=e,d("SET_WINDOW_TITLE",{title:e})}function L(e,t){return d("SET_WINDOW_SIZE",{width:e,height:t})}function A(){return d("SET_WINDOW_STATE","normal")}function R(){return d("SET_WINDOW_STATE","minimized")}function I(e){return d("SET_WINDOW_STATE",e)}var P=Object.freeze({__proto__:null,hideWindow:R,setTitle:_,setWindowSize:L,setWindowState:I,showWindow:A});function C(){window.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("DOMContentLoaded",()=>{y();const e=document.querySelector("title");new MutationObserver(o=>{o.forEach(y)}).observe(e,{childList:!0})})}function y(){_(document.title)}C();const g=Object.create(P);return Object.defineProperties(g,{sendMessage:{value:d,enumerable:!1,writable:!1},import:{enumerable:!1,writable:!1,value:M}}),g}();
